<?xml version="1.0"?>

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">

  <!-- There's no command for "insert if missing" so this transform uses a workaround to ensure it'll work on any config file that has at least the root <configuration /> element.
       The workaround is to insert the element you want regardless of whether it's already there, and if there are now two remove the second one. 
       
       The configSections element uses a similar but different workaround from http://stackoverflow.com/questions/18737022/xdt-transform-insertbefore-locator-condition-is-ignored
       which ensures that it's the first child of <configuration />
       -->

  <configSections xdt:Transform="InsertBefore(/configuration/*[1])" />
  <configSections xdt:Locator="XPath(/configuration/configSections[last()])">
    <sectionGroup name="Escc.ClientDependencyFramework" xdt:Transform="Insert" />
    <sectionGroup name="Escc.ClientDependencyFramework" xdt:Transform="Remove" xdt:Locator="XPath(/configuration/configSections/sectionGroup[@name='Escc.ClientDependencyFramework'][2])" />
  </configSections>
  <configSections xdt:Transform="RemoveAll" xdt:Locator="Condition(count(*)=0)" />

  <configSections>
    <sectionGroup name="Escc.ClientDependencyFramework" xdt:Locator="Match(name)">
      <section name="CssFiles" type="System.Configuration.NameValueSectionHandler, System, Version=1.0.5000.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" xdt:Transform="Insert" />
      <section name="CssFiles" xdt:Transform="Remove" xdt:Locator="XPath(/configuration/configSections/sectionGroup[@name='Escc.ClientDependencyFramework']/section[@name='CssFiles'][2])" />
    </sectionGroup>
  </configSections>

  <Escc.ClientDependencyFramework xdt:Transform="Insert" />
  <Escc.ClientDependencyFramework xdt:Transform="Remove" xdt:Locator="XPath(/configuration/Escc.ClientDependencyFramework[2])" />

  <Escc.ClientDependencyFramework>
    <CssFiles xdt:Transform="Insert" />
    <CssFiles xdt:Transform="Remove" xdt:Locator="XPath(/configuration/Escc.ClientDependencyFramework/CssFiles[2])" />
  </Escc.ClientDependencyFramework>

  <Escc.ClientDependencyFramework>
    <CssFiles>
      <add key="HandlerPath" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="HandlerPath" value="/css/{0}-v2.cssx" xdt:Transform="Insert" />

      <add key="1_Template1Small" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="1_Template1Small" value="/escc.eastsussexgovuk/css/min/small.css" xdt:Transform="Insert" />
      <add key="1_Template2Medium" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="1_Template2Medium" value="/escc.eastsussexgovuk/css/min/medium.css" xdt:Transform="Insert" />
      <add key="1_Template3Large" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="1_Template3Large" value="/escc.eastsussexgovuk/css/min/large.css" xdt:Transform="Insert" />
      <add key="1_TemplatePrint" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="1_TemplatePrint" value="/escc.eastsussexgovuk/css/min/print.css" xdt:Transform="Insert" />
      <add key="1_TemplateFullScreen" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="1_TemplateFullScreen" value="/escc.eastsussexgovuk/css/min/full-screen.css" xdt:Transform="Insert" />
      <add key="2_JQueryUI" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="2_JQueryUI" value="/escc.eastsussexgovuk/css/libs/jquery-ui-1.10.4.custom.min.css" xdt:Transform="Insert" />
      <add key="2_ContentSmall" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="2_ContentSmall" value="/escc.eastsussexgovuk/css/content-small.css" xdt:Transform="Insert" />
      <add key="2_ContentMedium" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="2_ContentMedium" value="/escc.eastsussexgovuk/css/content-medium.css" xdt:Transform="Insert" />
      <add key="2_ContentLarge" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="2_ContentLarge" value="/escc.eastsussexgovuk/css/content-large.css" xdt:Transform="Insert" />
      <!-- Do NOT minify the IE6 stylesheet, each style MUST be on a single line -->
      <add key="9_TemplateIE6Large" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="9_TemplateIE6Large" value="/escc.eastsussexgovuk/css/large-ie6.css" xdt:Transform="Insert" />

      <add key="Alert" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="Alert" value="/escc.eastsussexgovuk/css/min/alert.css" xdt:Transform="Insert" />
      <add key="CmsPreview" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="CmsPreview" value="/escc.eastsussexgovuk/css/min/umbraco-preview.css" xdt:Transform="Insert" />
      <add key="CoronerSkinSmall" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="CoronerSkinSmall" value="/escc.eastsussexgovuk/css/coroner-skin-small.css" xdt:Transform="Insert" />
      <add key="CoronerSkinMedium" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="CoronerSkinMedium" value="/escc.eastsussexgovuk/css/coroner-skin-medium.css" xdt:Transform="Insert" />
      <add key="EastSussex1Space" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="EastSussex1Space" value="/escc.eastsussexgovuk/css/min/1space.css" xdt:Transform="Insert" />
      <add key="EmailSmall" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="EmailSmall" value="/escc.eastsussexgovuk/css/min/govdelivery-button-small.css" xdt:Transform="Insert" />
      <add key="EmailLarge" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="EmailLarge" value="/escc.eastsussexgovuk/css/min/govdelivery-button-large.css" xdt:Transform="Insert" />
      <add key="EmailPanel" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="EmailPanel" value="/escc.eastsussexgovuk/css/min/govdelivery.css" xdt:Transform="Insert" />
      <add key="FormsSmall" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="FormsSmall" value="/escc.eastsussexgovuk/css/min/forms-small.css" xdt:Transform="Insert" />
      <add key="FormsMedium" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="FormsMedium" value="/escc.eastsussexgovuk/css/min/forms-medium.css" xdt:Transform="Insert" />
      <add key="FormsLarge" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="FormsLarge" value="/escc.eastsussexgovuk/css/min/forms-large.css" xdt:Transform="Insert" />
      <add key="GisMaps" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="GisMaps" value="/escc.eastsussexgovuk/css/min/maps.css" xdt:Transform="Insert" />
      <add key="MobileControls" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="MobileControls" value="/escc.eastsussexgovuk/css/min/mobile-controls.css" xdt:Transform="Insert" />
      <add key="NavigationSmall" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="NavigationSmall" value="/escc.eastsussexgovuk/css/min/nav-small.css" xdt:Transform="Insert" />
      <add key="NavigationMedium" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="NavigationMedium" value="/escc.eastsussexgovuk/css/min/nav-medium.css" xdt:Transform="Insert" />
      <add key="NavigationLarge" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="NavigationLarge" value="/escc.eastsussexgovuk/css/min/nav-large.css" xdt:Transform="Insert" />
      <add key="RssFeed" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="RssFeed" value="/escc.eastsussexgovuk/css/min/rss.css" xdt:Transform="Insert" />
      <add key="RssFeedXslt" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="RssFeedXslt" value="/escc.eastsussexgovuk/css/min/rss-xslt.css" xdt:Transform="Insert" />
      <add key="ServiceClosures" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="ServiceClosures" value="/escc.eastsussexgovuk/css/min/service-closures.css" xdt:Transform="Insert" />
      <add key="SocialMediaLarge" xdt:Transform="Remove" xdt:Locator="Match(key)" />
      <add key="SocialMediaLarge" value="/escc.eastsussexgovuk/css/min/social-media-large.css" xdt:Transform="Insert" />
    </CssFiles>
  </Escc.ClientDependencyFramework>
</configuration>
